syntax = "proto3";

package user.v1;

option go_package = "github.com/abhishek622/moviedock/gen/user/v1;userv1";

import "google/protobuf/struct.proto";
import "google/protobuf/timestamp.proto";

// -----------------------------
// Public User Profile (safe to expose)
// -----------------------------

message UserProfile {
  string user_id = 1;
  string name = 2;
  string email = 3;
  string role = 4;
  bool is_active = 5;
  string timezone = 6;
  google.protobuf.Timestamp last_login = 7;
  google.protobuf.Struct public_metadata = 8;
}

// -----------------------------
// Internal User Record (used within UserService only)
// -----------------------------

message InternalUser {
  string user_id = 1;
  string name = 2;
  string email = 3;
  string password_hash = 4;      
  string role = 5;
  bool is_active = 6;
  string timezone = 7;
  google.protobuf.Struct private_metadata = 8;
  google.protobuf.Timestamp created_at = 9;
  google.protobuf.Timestamp updated_at = 10;
  google.protobuf.Timestamp last_login = 11;
}

// -----------------------------
// Requests & Responses
// -----------------------------

message CreateUserRequest {
  string name = 1;
  string email = 2;
  string password = 3;        // Sent only during creation/login
  string role = 4;
  bool is_active = 5;
  string timezone = 6;
  google.protobuf.Struct public_metadata = 7;
}

message CreateUserResponse {
  UserProfile user = 1;
  string auth_token = 2;      
}

message GetUserRequest {
  string user_id = 1;
}

message GetUserResponse {
  UserProfile user = 1;
}

message UpdateUserRequest {
  string user_id = 1;
  string name = 2;
  string email = 3;
  string role = 4;
  bool is_active = 5;
  string timezone = 6;
  google.protobuf.Struct public_metadata = 7;
}

message UpdateUserResponse {
  UserProfile user = 1;
}

message DeleteUserRequest {
  string user_id = 1;
}

message DeleteUserResponse {
  bool success = 1;
}

message AuthenticateUserRequest {
  string email = 1;
  string password = 2;
}

message AuthenticateUserResponse {
  string auth_token = 1;
  UserProfile user = 2;
}

// -----------------------------
// User Service (gRPC)
// -----------------------------

service UserService {
  rpc CreateUser(CreateUserRequest) returns (CreateUserResponse);
  rpc GetUser(GetUserRequest) returns (GetUserResponse);
  rpc UpdateUser(UpdateUserRequest) returns (UpdateUserResponse);
  rpc DeleteUser(DeleteUserRequest) returns (DeleteUserResponse);
  rpc AuthenticateUser(AuthenticateUserRequest) returns (AuthenticateUserResponse);
}